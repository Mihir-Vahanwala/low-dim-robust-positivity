\section{Uniform Robustness: Decidability at order four}
\label{section:decidability}
In this section, we prove Theorem \ref{thm:decide}. The techniques naturally apply to lower orders, and we omit their explicit treatment. Recall that we must show how to check the validity of inequality \ref{eq:crux} for all (but finitely many) $n$:
$$
\seq{\mathbf{p}, \mathbf{q_n}} \ge \max_{\mathbf{f} \in \ball}\mathbf{q_n}^T\left(\mathbf{B}^{-1}\right)^T\mathbf{f} = ||\mathbf{B}^{-1}\mathbf{q_n}|| = \sqrt{\seq{\mathbf{b_1}, \mathbf{q_n}}^2 +\dots+\seq{\mathbf{b_\kappa}, \mathbf{q_n}}^2}
$$

Our main case distinction is on the number of pairs of complex conjugates among the roots. In each case, the plan is to first decide whether there exists a threshold index $N$ beyond which the LHS is always positive, and if so, compute it. This can always be done for order four LRS \cite{joeljames3}. We then square throughout, and transfer all terms to the LHS, thus obtaining a new instance of (Ultimate) Positivity. This plan is trivial to execute when all characteristic roots are real.

Thanks to the following old result \cite[Thm. 2]{positive-dominant}, the answer to Ultimate Positivity is trivially NO if there are two pairs of complex conjugates.

\begin{proposition}
\label{prop:folklore}
If the characteristic polynomial has no real dominant root of maximum multiplicity, then in any full-dimensional neighbourhood of initialisations, there exists an initialisation, such that the sequence has infinitely many positive terms, and infinitely many negative terms.
\end{proposition}

Thus, we shall concern ourselves with the case there is one pair of complex conjugate roots. Without loss of generality, we also assume that the real dominant root is $1$. We rely on specific applications of the following general results to analyse the trigonometric terms that arise.

\begin{theorem}[Masser \cite{Masser}]
  \label{thm:abelian}
  Let $e^{i \theta_1},...,e^{i \theta_k}$ be complex algebraic numbers of unit modulus. Consider the free abelian group $L$ defined by $L = \{(\lambda_1, \ldots ,\lambda_k) \in \mathbb{Z}^k: 
  e^{i (\lambda_1 \theta_1 + \cdots +  \lambda_k \theta_k)} = 1 \}$. 
  The group $L$ has a finite generator set $\{ \mathbf{l_1}, \ldots, \mathbf{l_p}\} \subset \mathbb{Z}^k$ with $p \le k$. The generator set can be computed in time polynomial and
  each entry in the generator set is polynomially bounded in the sizes of the representations of $e^{i \theta_1},...,e^{i \theta_k}$.
  \end{theorem}
 Given $e^{2i\theta}$, if an $n$ such that $e^{2i n \theta} = 1$ exists ($\theta$ is a rational multiple of $2\pi$), this $n$ is bounded, and can be efficiently found by enumeration. Similarly, one can check whether $\alpha^n = \beta$ (is $n\theta - \varphi$ ever an integer multiple of $2\pi$?). Suppose $\theta$ is not a rational multiple of $2\pi$. Then the following theorem establishes that $\{n\theta \text{ modulo } 2\pi\}_{n\in\naturals}$ is dense in $[0, 2\pi]$. Let $h$ be a trigonometric function of $t$ with period $2\pi$. Another immediate consequence is that
\begin{equation}
\label{eq:liminfmin}
\liminf_n h(n\theta)= \min_{t \in [0, 2\pi]} h(t)
\end{equation}
 
\begin{theorem}[Kronecker \cite{Kronecker}]
  \label{thm:kronecker}
  Let $\theta_1, ... , \theta_k, \phi_1, ... , \phi_k \in [0, 2\pi)$. Then the following are equivalent:
  \begin{enumerate}
\item For every tuple $(\lambda_1,...\lambda_k)$ of integers with 
    $\lambda_1 \theta_1 + \cdots +  \lambda_k \theta_k \in 2\pi\integers$, 
  we have \\$\lambda_1 \phi_1 + \cdots + \lambda_k \phi_k \in 2\pi\integers$.
  \item For any $\epsilon > 0$, there exists an arbitrarily large $n$ such that for all 
    $1 \le j \le k$ we have $| n \theta_j - \phi_j| \le \epsilon$.
    \end{enumerate}
  \end{theorem}
 
Considering the state-of-the-art, the following lemma is rather immediate. 
\begin{lemma}[Decidability for Simple LRS]
Problems \ref{prob:rrobpos} and \ref{prob:rrobuniultpos} are decidable for simple LRS of order four.
\end{lemma}
\begin{proof}
Let the distinct characteristic roots be $1, \alpha, \gamma, \bar{\gamma}$. Indeed, any inner product $\seq{\mathbf{v}, \mathbf{q_n}}$ may also expressed as $f_1 + f_2\alpha^n + f_3 \gamma^n + \bar{f_3}\bar{\gamma}^n$. On squaring throughout after the initial Positivity check, and transferring all terms to the LHS, we get a Positivity (Problem \ref{prob:pos}) instance for a new simple LRS, this time of order at most $10$. This time, the characteristic roots are $1, \alpha^2, \gamma^2, \bar{\gamma}^2, \alpha, \gamma, \bar{\gamma}, \alpha\gamma, \alpha\bar{\gamma}, \gamma\bar{\gamma}$: these are precisely the bases of the exponents in $(f_1 + f_2\alpha^n + f_3 \gamma^n + \bar{f_3}\bar{\gamma}^n)^2$.

We assume $\alpha \ne -1$: if it were, the resulting LRS could be decomposed into two LRS of lower order, and both Ultimate Positivity \cite{ouaknine2014ultimate} and Positivity  \cite{ouaknine2014positivity} for simple LRS is known to be decidable for order up to nine. For the same reason, we can also assume $\gamma/\bar{\gamma}$ is not a root of unity: this can be efficiently detected, see Theorem \ref{thm:abelian}. Thus, depending on whether $|\gamma| < 1$ or $= 1$, the resulting LRS either has only $1$ as a dominant root, and nine non-dominant roots, or has five dominant roots, $1, \gamma, \bar{\gamma}, \gamma^2, \bar{\gamma}^2$ ($\gamma\bar{\gamma} = 1$) and four non-dominant roots. The former case is trivial, while the latter is handled by \cite{ouaknine2014positivity}.
\end{proof}

The only remaining possibility, therefore, is that the characteristic roots are $1, 1, \gamma, \bar{\gamma}$. Let $0 < |\gamma| = \rho \le 1$, and we again assume that $\gamma/\bar{\gamma}$ is not a root of unity, for reasons described above. On squaring after the initial check, our LRS is of the form
\begin{align*}
&z_2n^2 + z_1n + z_0  \\
&+ x_2 n \rho^n \cos n\theta + y_2 n \rho^n \sin n\theta  \\
&+ x_1\rho^n\cos n\theta + y_1\rho^n\sin n\theta  \\
&+ x_0 \rho^{2n}\cos 2n\theta + y_0 \rho^{2n} \sin 2n\theta + w\rho^{2n} \ge 0
\end{align*}
If $\rho < 1$, the above can trivially be resolved with growth arguments, or is an easy order $3$ LRS. Thus, we assume $\rho = 1$. If $z_2 \ne 0$, then decidability is trivial; hence we assume $z_2 = 0$. In this case, our inequality can be arranged as
\begin{equation}
\label{eq:groundtruth}
{\color{red!70!black} n(z_1 + x_2\cos n\theta + y_2\sin n\theta)} + (z_0 + x_1\cos n\theta + y_1\sin n\theta + x_0\cos 2n\theta + y_0\sin 2n\theta) \ge 0
\end{equation}
Decidability is most clearly seen through a slight shift in perspective: for any $x, y, \phi$, there exist $x', y'$ such that $x\cos \alpha + y\sin\alpha = x'\cos(\alpha - \phi) + y'\sin (\alpha - \phi)$ is an identity in $\alpha$. Thus, note that for a convenient choice of $\varphi$, inequality \ref{eq:groundtruth} can easily be rewritten as (we use $t_n$ as shorthand for $n\theta - \varphi$, and choose $\varphi$ such that $x_2' \le 0$)
\begin{equation}
\label{eq:groundtruthrewrite}
{\color{red!70!black}n(z_1 + x_2' \cos t_n)} + (z_0 + x_1'\cos t_n + y_1'\sin t_n + x_0'\cos 2t_n + y_0'\sin 2t_n) \ge 0
\end{equation}

Observe that there is nothing special about the particular representation of inequality \ref{eq:groundtruth}. The common proposition that both \ref{eq:groundtruth} and \ref{eq:groundtruthrewrite} convey is that 
$$
\left(\mathbf{e_1}^T\mathbf{A}^n\mathbf{c}\right)^2 - \left(\max_{\mathbf{d} \in \ball_{\mathbf{S}}} \mathbf{e_1}^T\mathbf{A}^n\mathbf{d}\right)^2 \ge 0
$$

On retracing our steps back to the discussion surrounding equation \ref{eq:innerprod}, we could well have chosen our basis of solutions to be $\mathbf{x_n'}\begin{bmatrix}n & 1 & \cos(n\theta - \varphi) & \sin(n\theta - \varphi) \end{bmatrix}$. This would have given us different $\mathbf{V'}, \mathbf{M'}$, and hence $\mathbf{B'}$ in equation \ref{eq:crux}, but importantly, it would generate inequality \ref{eq:groundtruthrewrite} for the same original input.

Since we assume $\theta$ is not a rational multiple of $2\pi$, we can argue by Theorem \ref{thm:kronecker} (Kronecker) that $\{(n\theta - \varphi)$ modulo ${2\pi}\}_{n\in\naturals}$ is dense in $[0, 2\pi]$. 
We define 
\begin{align}
f(t) &= z_1 + x_2'\cos t  \\
g(t) &= z_0 + x_1'\cos t + y_1'\sin t + x_0'\cos 2t + y_0'\sin 2t
\end{align}
Since we chose $x_2' \le 0$, it is clear that $f$ attains its minima at $0$. If $z + x_2' < 0$, then the inequality will be violated for infinitely many $n$ for which $[n\theta - \varphi]_{2\pi}$ is close enough to $0$; on the other hand, if $z + x_2' > 0$, then it is guaranteed to hold beyond a computable threshold index $N$.

Thus, we assume, $z_1 + x_2' = 0$, i.e.\ the minimal $f(0) = 0$. If $g(0) > 0$, we are done: we can easily get a positive lower bound on $f$ for values where $g < 0$, and get an $N$ beyond which the validity of inequality \ref{eq:groundtruthrewrite} is guaranteed. On the other hand, if $g < 0$, we argue that inequality \ref{eq:groundtruthrewrite} is violated for infinitely many $n$. Recall inequality \ref{eq:quadraticdecay}. It tells us that there are infinitely many $n$ for which $f(n\theta - \varphi) < c/n^2$. Thus, the terms in red are infinitely often lower bounded by $c/n$, while the terms in black, for the same $n$, would be close to a negative constant. Thus, we can return NO for robust Ultimate Positivity.

The final case that remains is $g(0) = 0$. We argue that remarkably, it does not arise at all!
\begin{lemma}
The scenario where $z_2 = 0$, $z_1 + x_2' = 0$, and $z_0 + x_1'+ x_0' = 0$ is impossible.
\end{lemma}
\begin{proof}
Suppose that $\mathbf{b_1}^T, \dots, \mathbf{b_4}^T$ are the rows of the matrix $(\mathbf{B'})^{-1}$, and $\mathbf{u_1}, \dots, \mathbf{u_4}$ are the columns. Our inequality is:
\begin{align*}
(p_1 n + p_2 + p_3\cos(n\theta - \varphi) + p_4\sin(n\theta - \varphi))^2 \\
- \left( \dots + (b_{i1} n + b_{i2} + b_{i3}\cos(n\theta - \varphi) + b_{i4}\sin(n\theta - \varphi))^2 + \dots \right) \ge 0
\end{align*}
In the table, we explicitly give each coefficient of inequality \ref{eq:groundtruthrewrite}.
\begin{table}[H]
\begin{tabular}{|l|l|l|}
  \hline
   \textbf{Term}& \textbf{Coefficient}& {\bf Explicitly} \\
  \hline
  $n^2$ & $z_2 = 0$ & $p_1^2 - \seq{\mathbf{u_1}, \mathbf{u_1}}$ \\
   \hline
  $n$ & $z_1$ & $2p_1p_2 - 2\seq{\mathbf{u_1}, \mathbf{u_2}}$ \\
   \hline
  $n\cos (n\theta - \varphi)$ & $x_2'$ & $2p_1p_3 - 2\seq{\mathbf{u_1}, \mathbf{u_3}}$ \\
   \hline
  $n\sin (n\theta - \varphi)$ & $y_2' = 0$ & $2p_1p_4 - 2\seq{\mathbf{u_1}, \mathbf{u_4}}$ \\
   \hline
  $1$ & $z_0$ & $p_2^2 + \frac{1}{2}(p_3^2 + p_4^2) - \seq{\mathbf{u_2}, \mathbf{u_2}} - \frac{1}{2}
 (\seq{\mathbf{u_3}, \mathbf{u_3}} + \seq{\mathbf{u_4}, \mathbf{u_4}})$ \\
  \hline
  $\cos (n\theta-\varphi)$ & $x_1'$ & $2p_2p_3 - 2\seq{\mathbf{u_2}, \mathbf{u_3}}$ \\
   \hline
  $\sin (n\theta-\varphi)$ & $y_1'$ & $2p_2p_4 - 2\seq{\mathbf{u_2}, \mathbf{u_4}}$ \\
   \hline
  $\cos (2n\theta - 2\varphi)$ & $x_0'$ & $\frac{1}{2}(p_3^2 - p_4^2) - \frac{1}{2}(\seq{\mathbf{u_3}, \mathbf{u_3}} - \seq{\mathbf{u_4}, \mathbf{u_4}})$ \\
   \hline
  $\sin (2n\theta - 2\varphi)$ & $y_0'$ & $2p_3p_4 - 2\seq{\mathbf{u_3}, \mathbf{u_4}}$ \\
  \hline
\end{tabular}
\end{table}
Suppose, for the sake of contradiction, the scenario actually occurs. We then respectively have
\begin{align*}
p_1^2 &= \seq{\mathbf{u_1}, \mathbf{u_1}} \\
p_1(p_2 + p_3) &= \seq{\mathbf{u_1}, \mathbf{u_2} + \mathbf{u_3}} \\
(p_2 + p_3)^2 &= \seq{\mathbf{u_2} + \mathbf{u_3}, \mathbf{u_2} + \mathbf{u_3}}
\end{align*}
This implies that $|\seq{\mathbf{u_1}, \mathbf{u_2} + \mathbf{u_3}}| = ||\mathbf{u_1}||\cdot||\mathbf{u_2} + \mathbf{u_3}||$, i.e. $\mathbf{u_1}$ is a scaled multiple of $\mathbf{u_2} + \mathbf{u_3}$. This contradicts the fact that the columns of the invertible $(\mathbf{B'})^{-1}$ are linearly independent, and we're done.
\end{proof}


