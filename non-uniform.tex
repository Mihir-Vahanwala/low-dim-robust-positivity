\section{Non-uniform Robustness: Decidability at order four}
\label{section:decidability2}


In this section, we prove Theorem \ref{thm:decide2}. The techniques naturally apply to lower orders, and we omit their explicit treatment. Recall the critical condition from our overview in \S\ref{section:nonuniformoverview}:
\begin{equation}
\mu(\mathbf{c'}) = \liminf_{n\in \naturals}\seq{\mathbf{p'}, \mathbf{q_n}}_{dom} \ge 0
\end{equation}
for all $\mathbf{c'}$ in the neighbourhood is necessary for the decision to be YES; the inequality holding strictly is sufficient. Critical cases arise when the surface of the neighbourhood touches the region where $\mu = 0$, and the non-dominant terms, if any, can potentially have a negative contribution. We demonstrate that these can be detected and dealt with.

Since Proposition \ref{prop:folklore} guarantees the existence of a real positive dominant term, $\seq{\mathbf{p}, \mathbf{q_n}}_{dom}$ can only be of one of the following forms: {\bf(a)} $z$; {\bf(b)} $z + w(-1)^n$; {\bf(c)} $z + x\cos n\theta + y\sin n\theta$; {\bf(d)} $z + x\cos n\theta + y\sin n\theta + w(-1)^n$, where $x, y, z, w$ are linear in the initialisation $\mathbf{c}$. Cases (a), (b), and (c), (d) where $\theta$ is a rational multiple of $2\pi$ (detected with Lemma \ref{lemma:rootofunity}) are the easiest. The region $\mu \ge 0$ is carved out by \textit{finitely} many halfspaces, defined by separating hyperplanes of the form $z + bw + c_0 x + s_0 y = 0$. By elementary linear algebra and co-ordinate geometry (e.g.\. by working in a basis where the neighbourhood is a perfect hypersphere), one can determine whether $\mu > 0$ for the entire neighbourhood, or whether $\mu < 0$ for some points in the neighbourhood, or whether the neighbourhood touches a hyperplane. Each hyperplane has at most one point of tangency, whose algebraic coordinates can be solved for.  These critical points are low-dimensional instances of Ultimate Positivity, and can be decided with the state of the art \cite{ouaknine2014ultimate}.

We therefore assume that $\theta$ is not a rational multiple of $2\pi$, and we are in Case (c) or (d). We apply Lemma \ref{eq:liminfmin}, we get that 
\begin{equation}
\mu(\mathbf{c}) = \liminf_{n \in \naturals} \seq{\mathbf{p}, \mathbf{q_n}} = \min_{t \in \reals, b \in \{\pm 1\}} z + x\cos t + y\sin t + wb = z - \sqrt{x^2 + y^2} - |w|.
\end{equation}
If we are in Case (d), there are no dominant roots, and $\mu \ge 0$ throughout the neighbourhood is necessary as well as sufficient for the decision to be YES. This is an algebraic condition, and can be checked using the First Order Theory of the Reals.\footnotemark

\footnotetext{$|w|$ is expressed with $\exists r.~r^2 = w^2 \land r \ge 0$; a similar trick works for $\sqrt{x^2 + y^2}$.}

Case (c) remains. $\seq{\mathbf{q_n}, \mathbf{p}} = z + x\cos n\theta + y\sin n\theta + w\alpha^n$, where $0 < |\alpha| < 1$. As discussed, we can use the First Order Theory of the Reals to check the sufficient $\mu > 0$, and the necessary $\mu \ge 0$ throughout the neighbourhood. We consider the scenario where the necessity check succeeds, but the sufficiency check fails. The decision can be NO only if there are points on the surface of the neighbourhood where $\mu = 0$, and the non-dominant $w\alpha^n$ can make a negative contribution. We describe how these points are found and analysed. First, we observe that the region $\mu \ge 0$ is given by the cone $z - \sqrt{x^2 + y^2} \ge 0$. It can be intuited as being carved out by a continuum of hyperplanes $z + x\cos\phi + y\sin\phi = 0$. We encode the above discussion to find the critical points with the following first order formula with free variable $c$, which stands for $\cos \phi$
\begin{equation}
\label{eq:intersection}
\chi_1(c):= \exists s \exists \mathbf{c'}.~ (\mathbf{c'} - \mathbf{c})^T\mathbf{S}(\mathbf{c'} - \mathbf{c}) = 1 \land z' + cx' + sy' = 0 \land c^2 + s^2 = 1 \land w' \sim 0.
\end{equation}

In the above $\sim$ is $\ne$ if the non-dominant root $\alpha < 0$, and is $<$ if $\alpha > 0$. We can use Theorem \ref{thm:renegar} to get an equivalent quantifier free formula: this comprises purely of polynomial (in-)equalities in the free variable $c$. The set of $c$, and hence $\cos \phi$, satisfying these, consists of finitely many intervals. Of course, Ultimate Positivity is guaranteed when this set is empty: it means there are no points threatening to violate Ultimate Positivity.

We first dispose of the case where all intervals consist of single points. Consider an interval $\{c_0\}$ consisting of a single point. This is illustrated by the case of the ball touching the cone in Figure \ref{fig:geometricpicture}. Due to its origins and discrete occurrence, $c_0$ must be a root of a polynomial obtained by quantifier elimination on $\chi_1$, and is hence algebraic. The corresponding critical point is the point of tangency of the neighbourhood with a hyperplane with a real algebraic equation. Thus, it generates a real algebraic instance of Ultimate Positivity, which can be with the techniques of \cite{ouaknine2014ultimate}.

If, however, the set of $c$ satisfying $\chi_1$ consists of intervals that have more than one point, then the techniques of \cite{ouaknine2014ultimate} to decide Ultimate Positivity for a single point with algebraic coordinates are no longer accessible. This situation is illustrated by the case of the ball nestled in cone in Figure \ref{fig:geometricpicture}. Let $[\phi_1, \phi_2]$ be an interval of $\phi$ such that: a) all values of $c$ between $\cos\phi_1$ and $\cos\phi_2$ satisfy $\chi_1$, b) The corresponding witnesses $z'$ are at most $z_0$, and c) The corresponding witnesses $w'$ have magnitude at least some fixed $w_0$. Then, we must have for each $\phi$ (and corresponding $z(c), x = -cz, y = -z\sin \phi, w)$) in this interval, the following inequality is violated only finitely often:
\begin{equation}
z - z\cos(n\theta - \phi) + w\alpha^n \ge 0.
\end{equation}

We consider an even weaker inequality, which, in this context, we argue is bound to be violated infinitely often:
\begin{equation}
z_0[n\theta - \phi]_{2\pi}^2  \ge 2w_0\alpha^n.
\end{equation}

The argument hinges on Lemma \ref{lemma:existsreal}, which we restate:
\begin{lemma}
\label{lemma:existsreal3}
For every irrational number $x$, strictly decreasing real positive function $\psi$, and interval $\mathcal{I} = [a, b] \subset [0, 1], ~ a \ne b$, there exists $y_0 \in \mathcal{I}$ such that $[nx - y_0] < \psi(n)$ for infinitely many even $n$, and $y_1 \in \mathcal{I}$ such that $[nx - y_1] < \psi(n)$ for infinitely many odd $n$.
\end{lemma}

Now, if $\alpha < 0$, we use Lemma \ref{lemma:existsreal3} on the irrational $\theta/2\pi$, and the decreasing $\sqrt{\frac{w_0 |\alpha|^n}{2\pi^2z_0}}$ to argue that there exists a $\phi$ in the desired interval, such that the weaker inequality will be violated for infinitely many $n$ of the the appropriate parity. Thus, we can return NO if we are in the case where the set of $c$ satisfying $\chi_1$ (equation \ref{eq:intersection}) consists of intervals that contain more than a single point.

